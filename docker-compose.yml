version: "3.9"

services:
  headscale:
    image: headscale/headscale:latest
    container_name: headscale
    restart: unless-stopped
    ports:
      - "8080:8080"       # gRPC + HTTP (Tailscale clients)
      - "8090:8090"       # metrics (optional)
    volumes:
      - headscale_data:/var/lib/headscale
      - ./config:/etc/headscale/
    command: headscale serve
    environment:
      - TZ=Etc/UTC

  # Official Headscale Web Admin (the one from gurucomputing)
  headscale-admin:
    image: ghcr.io/gurucomputing/headscale-admin:latest
    container_name: headscale-admin
    restart: unless-stopped
    ports:
      - "8001:80"
    environment:
      - AUTHENTICATION_METHOD=disabled   # remove this line later when you want login
      - BASE_DOMAIN=localhost             # works fine locally
    depends_on:
      - headscale

  # Pangolin â€“ the beautiful modern UI everyone loves
  pangolin:
    image: gulled/pangolin:latest
    container_name: pangolin
    restart: unless-stopped
    ports:
      - "8002:8080"
    environment:
      # Important: use the container name + port, NOT localhost
      - HEADSCALE_URL=http://headscale:8080
    depends_on:
      - headscale

volumes:
  headscale_data: